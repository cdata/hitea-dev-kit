{"version":3,"file":"drawing-room-d8555d26.js","sources":["../node_modules/@0xcda7a/bag-of-tricks/src/state/provide.ts","../node_modules/@0xcda7a/bag-of-tricks/src/state/store.ts","../src/utilities/color.ts","../src/state/store.ts","../src/entrypoints/drawing-room.ts"],"sourcesContent":["import { Store } from './store.js';\nimport { StoreRequestedDetails } from './types.js';\n\n/**\n * Given an EventTarget, listen for events that request a store and provide\n * a configured store to the originating event dispatcher.\n */\nexport const provide = <T extends EventTarget, U extends {} = {}>(\n  scope: T,\n  store: Store<U>\n) => {\n  const connectStore = (event: CustomEvent<StoreRequestedDetails<U>>) => {\n    const { requestor } = event.detail;\n    event.stopImmediatePropagation();\n    requestor.connectStore(store);\n  };\n\n  scope.addEventListener('store-requested', connectStore as EventListener);\n};\n","export type Action<T extends {}> = (\n  getState: GetState<T>,\n  dispatch: Dispatch<T>\n) => T | void | Promise<T | void>;\nexport type Dispatch<T extends {} = {}> = (action: Action<T>) => Promise<void>;\nexport type GetState<T extends {} = {}> = () => T;\nexport type ActionCreator<T extends {}, U extends readonly any[]> = (\n  ...args: U\n) => Action<T>;\n\nexport const $name = Symbol('name');\nexport type NamedAction<T extends {}> = Action<T> & {\n  [$name]: string;\n};\n\nexport type SelfDispatchingActionCreator<T extends any[]> = (\n  ...args: T\n) => Promise<void>;\n\nexport type Middleware<T extends {}> = (store: Store<T>) => Store<T>;\n\nconst defaultLogger = (actionName: string, state: any) =>\n  console.warn(`Action<${actionName}>`, state);\n\nexport interface StoreOptions<T extends {}> {\n  verbose?: boolean;\n  logger?: (\n    logger: (...args: any) => void,\n    actionName: string,\n    state: T\n  ) => void;\n  middleware?: Middleware<T>[];\n}\n\nexport const action = <T extends {}>(\n  name: string,\n  action: Action<T>\n): NamedAction<T> => {\n  (action as NamedAction<T>)[$name] = name;\n  return action as NamedAction<T>;\n};\n\nexport const isNamedAction = <T extends {}>(\n  action: Action<T>\n): action is NamedAction<T> => {\n  return (action as NamedAction<T>)[$name] != null;\n};\n\nexport class Store<T extends {} = {}> extends EventTarget {\n  #state: T;\n  #verbose: boolean;\n  #logger: (actionName: string, state: T) => void;\n\n  constructor(initialState: T, options: StoreOptions<T> = {}) {\n    super();\n\n    this.#state = initialState;\n    this.#verbose = !!options.verbose;\n\n    const { logger, middleware } = options;\n\n    this.#logger =\n      logger != null\n        ? (actionName: string, state: T) =>\n            logger(defaultLogger, actionName, state)\n        : defaultLogger;\n\n    let store: Store<T> = this;\n\n    if (middleware != null) {\n      for (const ware of middleware) {\n        store = ware(store);\n      }\n    }\n\n    return store;\n  }\n\n  get state() {\n    return this.#state;\n  }\n\n  async dispatch(action: Action<T>): Promise<void> {\n    const newState = await action(\n      () => this.state,\n      (action: Action<T>) => this.dispatch(action)\n    );\n\n    if (newState == null) {\n      return;\n    }\n\n    if (this.#verbose) {\n      const name = isNamedAction(action) ? action[$name] : 'ANONYMOUS';\n      this.#logger(name, newState);\n    }\n\n    this.#state = newState;\n    this.dispatchEvent(new CustomEvent('state-change'));\n  }\n}\n","export const rgb565ToInt = (r: number, g: number, b: number) =>\n  ((r & 0x1f) << 11) + ((g & 0x3f) << 5) + (b & 0x1f);\n\nexport const intToRgb565 = (rgb565: number) => ({\n  r: (rgb565 >> 11) & 0x1f,\n  g: (rgb565 >> 5) & 0x3f,\n  b: rgb565 & 0x1f,\n});\n\nexport const rgbToInt = (r: number, g: number, b: number) =>\n  ((r & 0xff) << 16) + ((g & 0xff) << 8) + (b & 0xff);\n\nexport const intToRgb = (rgb: number) => ({\n  r: (rgb >> 16) & 0xff,\n  g: (rgb >> 8) & 0xff,\n  b: rgb & 0xff,\n});\n\nexport const intRgbToRgb565 = (rgb: number) => {\n  const { r: r0, g: g0, b: b0 } = intToRgb(rgb);\n  const { r, g, b } = rgbToRgb565(r0, g0, b0);\n\n  return rgb565ToInt(r, g, b);\n};\n\nexport const intRgb565ToRgb = (rgb565: number) => {\n  const { r: r0, g: g0, b: b0 } = intToRgb565(rgb565);\n  const { r, g, b } = rgb565ToRgb(r0, g0, b0);\n\n  return rgbToInt(r, g, b);\n};\n\nexport const rgbToRgb565 = (r: number, g: number, b: number) => ({\n  r: Math.round((r / 0xff) * 0x1f) | 0,\n  g: Math.round((g / 0xff) * 0x3f) | 0,\n  b: Math.round((b / 0xff) * 0x1f) | 0,\n});\n\nexport const rgb565ToRgb = (r: number, g: number, b: number) => ({\n  r: Math.round((r / 0x1f) * 0xff) | 0,\n  g: Math.round((g / 0x3f) * 0xff) | 0,\n  b: Math.round((b / 0x1f) * 0xff) | 0,\n});\n\nexport const rgb565MappedRgb = (rgb: number) =>\n  intRgb565ToRgb(intRgbToRgb565(rgb));\n\nexport const intToCssHex = (int: number) => {\n  let hexString = (int & 0xffffff).toString(16);\n  while (hexString.length < 6) {\n    hexString = `0${hexString}`;\n  }\n  return `#${hexString}`;\n};\n\n// (self as any).rgb565ToRgb = rgb565ToRgb;\n// (self as any).rgbToRgb565 = rgbToRgb565;\n// (self as any).intRgb565ToRgb = intRgb565ToRgb;\n// (self as any).intRgbToRgb565 = intRgbToRgb565;\n// (self as any).rgb565MappedRgb = rgb565MappedRgb;\n","import { Store } from '@0xcda7a/bag-of-tricks/lib/state/store.js';\nimport { rgb565MappedRgb } from '../utilities/color';\n\nexport type Tool = 'pen' | 'eraser' | 'menu';\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport interface Selection {\n  start: Point;\n  end: Point;\n}\n\nexport interface SpriteSheetLayer {\n  id: string | null;\n  pixels: number[];\n}\n\nexport interface SpriteSheetPalette {\n  // Null ID implies default palette\n  id: string | null;\n  colors: number[];\n}\n\nexport interface TileColorScheme {\n  transparentColor: number;\n  palette: string;\n}\n\nexport interface SpriteSheetColorScheme {\n  defaultPalette: string | null;\n  tiles: TileColorScheme[];\n}\n\nexport interface SpriteSheet {\n  palettes: SpriteSheetPalette[];\n  layers: SpriteSheetLayer[];\n  colorScheme: SpriteSheetColorScheme;\n  columns: number;\n  rows: number;\n  tilePixelWidth: number;\n  tilePixelHeight: number;\n}\n\nexport interface SyncRequest {\n  type: 'sync';\n  selection?: Selection;\n}\n\nexport type Task = SyncRequest;\n\nexport interface DrawingRoomState {\n  activeTool: Tool;\n  activeColor: number;\n  activePalette: number;\n  selection: Selection;\n  spriteSheet: SpriteSheet;\n  userIsDragging: boolean;\n  taskQueue: Task[];\n}\n\nexport interface HiTeaDevState {\n  drawingRoom: DrawingRoomState;\n}\n\nexport const emptySelection = () => ({\n  start: {\n    x: 0,\n    y: 0,\n  },\n  end: {\n    x: 1,\n    y: 1,\n  },\n});\n\n// http://androidarts.com/palette/16pal.htm\nexport const defaultPalette = (): SpriteSheetPalette => ({\n  id: null,\n  colors: [\n    rgb565MappedRgb(0x000000),\n    rgb565MappedRgb(0x9d9d9d),\n    rgb565MappedRgb(0xffffff),\n    rgb565MappedRgb(0xbe2633),\n    rgb565MappedRgb(0xe06f8b),\n    rgb565MappedRgb(0x493c2b),\n    rgb565MappedRgb(0xa46422),\n    rgb565MappedRgb(0xeb8931),\n    rgb565MappedRgb(0xf7e26b),\n    rgb565MappedRgb(0x2f484e),\n    rgb565MappedRgb(0x44891a),\n    rgb565MappedRgb(0xa3ce27),\n    rgb565MappedRgb(0x1b2632),\n    rgb565MappedRgb(0x005784),\n    rgb565MappedRgb(0x31a2f2),\n    rgb565MappedRgb(0xb2dcef),\n  ],\n});\n\nexport const store = new Store<HiTeaDevState>(\n  {\n    drawingRoom: {\n      activeTool: 'pen',\n      activePalette: 0,\n      activeColor: 0,\n      userIsDragging: false,\n      taskQueue: [],\n      spriteSheet: {\n        columns: 8,\n        rows: 16,\n        tilePixelWidth: 8,\n        tilePixelHeight: 8,\n        palettes: [defaultPalette()],\n        layers: [\n          {\n            id: null,\n            pixels: [],\n          },\n        ],\n        colorScheme: {\n          defaultPalette: null,\n          tiles: [],\n        },\n      },\n      selection: emptySelection(),\n    },\n  },\n  {\n    verbose: false,\n  }\n);\n","import { provide } from '@0xcda7a/bag-of-tricks/lib/state/provide.js';\nimport { store } from '../state/store.js';\n\nprovide(self, store);\n\nimport('../components/drawing-room-app.js');\n"],"names":[],"mappings":"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"}